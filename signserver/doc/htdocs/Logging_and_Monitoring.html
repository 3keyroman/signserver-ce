<!doctype html>

<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">

        <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1">

        <link rel="icon" href="_scroll_external/attachments/e415105eb31a/ssdocs">

        <!-- Primary Meta Tags -->
        <meta name="exp-export-timestamp" content="2024-10-09T09:36:32.770+0000">
        <meta name="exp-page-id" content="371000481">
        <meta name="exp-page-title" content="Logging and Monitoring">
        <meta name="exp-page-version" content="1">
        <meta name="exp-page-scroll-page-id" content="fbbdae2152c68e3ccaabd3477664640f">
        <meta name="exp-page-created" content="2022-11-18T15:06:40.000+0000">
        <meta name="exp-page-last-modified" content="2022-11-25T15:15:27.000+0000">
        <meta name="exp-page-labels" content="">
        <meta name="exp-page-context-keys" content="">
        <meta name="exp-space-key" content="SSDOCS">
        <meta name="exp-space-title" content="SignServer Documentation">

        <!-- Additional Meta Tags -->
        <meta name="exp-document-id" content="371111034">
        <meta name="exp-document-title" content="SignServer Documentation">
        <meta name="exp-version-status" content="in-progress">
        <meta name="exp-version-id" content="8a3e757d15e64586aa644eaf0980f27a">
        <meta name="exp-version-name" content="Working version">
        <meta name="exp-version-description" content="">
        <meta name="exp-version-date" content="2024-02-17T13:18:25Z">
        <meta name="exp-variant-id" content="">
        <meta name="exp-variant-name" content="">
        <meta name="exp-variant-description" content="">
        <meta name="exp-language-code" content="">
        <meta name="exp-language-name" content="">

        <link rel="stylesheet" href="css/app.css">
        <link rel="stylesheet" href="css/image-dimensions.css">


            
            
<script src="js/search.js"></script>
            <script id="search-worker" type="javascript/worker">
    onmessage = function(event) {
        // dispatch events to handling functions
        var message = event.data;

        if ((message.type === 'setup') && message.baseUrl) {
            setup(message.baseUrl);
        }

        if (message.type === 'search-request') {
            search(message.query);
        }
    }

    var searchIndex;

    function setup(baseUrl) {
        importScripts(
            baseUrl + 'js/lunr.js',
            baseUrl + 'js/lunr-index.js',
            baseUrl + 'js/lunr-data.js'
        );
        try {
            // load lunr-extras if it exists, which contains language-specific files for languages other than english
            importScripts(baseUrl + 'js/lunr-extras.js');
        } catch (e) {}
        searchIndex = lunr.Index.load(lunrIndex);
    }

    function search(query) {
        var searchHits = searchIndex.search(query);
        var results = searchHits.map(function (result) {
            return lunrData.filter(function (d) {
                return d.id === result.ref;
            })[0]
        });
        postMessage({ type: 'search-results', results: results, query: query });
    }
</script>
        <title>Logging and Monitoring</title>

    <meta name="generator" content="Scroll HTML Exporter / K15t GmbH"></head>

    <body id="LoggingandMonitoring-top" data-pageid="371000481" data-confluence-editor-version="v1" data-confluence-deployment-type="CLOUD">

        <div class="exp-grid-container">

            <header class="exp-header"></header>

            <div class="exp-logo">
                <a href="SignServer_Documentation.html">
                    <span class="exp-logo-image" style="background-image: url(_scroll_external/attachments/e415105eb31a/ssdocs)" alt="SignServer Documentation" title="SignServer Documentation"></span>
                </a>
            </div>

            <div class="exp-document-title">
                <h1 class="exp-document-title-heading scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h1 scroll-relative-h1" data-scroll-heading-rank="1" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="1" id="no-src_generated-id-b9c176139110b3643437346f54ad793ce394cbfdb9558ef645acae09fc055d32">
                    <a href="SignServer_Documentation.html">
                        SignServer Documentation
                    </a>
                </h1>
            </div>

<div class="exp-search-container">
    <input type="search" id="search-textbox" autocomplete="off" class="exp-search-input" style="margin-right: 0;">
    <div class="exp-search-input-icon">
        <svg data-exp-id="magnifier-icon" data-exp-component="icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewbox="0 0 20 20" fill="none" aria-hidden="true">
            <path d="M8.99452 14.5C10.5121 14.5 11.809 13.9669 12.8854 12.9007C13.9618 11.8345 14.5 10.5361 14.5 9.00548C14.5 7.48794 13.9631 6.19097 12.8893 5.11458C11.8155 4.03819 10.519 3.5 9 3.5C7.46786 3.5 6.16816 4.0369 5.1009 5.11071C4.03363 6.18453 3.5 7.48096 3.5 9C3.5 10.5321 4.0331 11.8318 5.09929 12.8991C6.1655 13.9664 7.46391 14.5 8.99452 14.5ZM9 16C8.02913 16 7.11974 15.816 6.27185 15.4479C5.42395 15.0799 4.68056 14.5799 4.04167 13.9479C3.40278 13.316 2.90278 12.576 2.54167 11.728C2.18056 10.88 2 9.97053 2 8.99956C2 8.04152 2.18403 7.13542 2.55208 6.28125C2.92014 5.42708 3.41864 4.68387 4.04758 4.0516C4.67653 3.41935 5.41569 2.91935 6.26508 2.5516C7.11449 2.18387 8.02548 2 8.99806 2C9.95769 2 10.8646 2.18403 11.7188 2.55208C12.5729 2.92014 13.316 3.42014 13.9479 4.05208C14.5799 4.68403 15.0799 5.42612 15.4479 6.27835C15.816 7.13058 16 8.0381 16 9.00094C16 9.83365 15.8615 10.6213 15.5846 11.3638C15.3078 12.1062 14.9254 12.7836 14.4375 13.3958L18 16.9583L16.9375 18L13.375 14.4583C12.7668 14.9459 12.0939 15.3247 11.3564 15.5948C10.6188 15.8649 9.83333 16 9 16Z" fill="currentColor" />
        </svg>
    </div>
    <div id="search-suggestion-container" class="exp-search-suggestion-panel" data-exp-component="search-suggestion"></div>
    <template id="exp-search-suggestion-option-template">
        <div class="exp-search-suggestion-option-container search-form-suggestion">
            <a class="exp-search-suggestion-option search-form-suggestion" href=""></a>
        </div>
    </template>
</div>


            <nav class="exp-sidebar-navigation">
                <div class="exp-sidebar-navigation-sticky-wrapper">
                    <iframe src="toc.html?pageId=371000481" border="0"></iframe>
                </div>

            </nav>


            <nav aria-label="Breadcrumb" class="exp-breadcrumbs-wrapper">
                <ol class="breadcrumbs">
                        <li class="breadcrumb">
                            <a href="SignServer_Documentation.html" rel="prev" target="_self">SignServer Documentation</a>
                        </li>
                        <li class="breadcrumb">
                            <a href="SignServer_Reference.html" rel="prev" target="_self">SignServer Reference</a>
                        </li>
                        <li class="breadcrumb">
                            <a href="SignServer_TimeMonitor_Application.html" rel="prev" target="_self">SignServer TimeMonitor Application</a>
                        </li>
                        <li class="breadcrumb">
                            <a href="SignServer_TimeMonitor_Overview.html" rel="prev" target="_self">SignServer TimeMonitor Overview</a>
                        </li>
                    <li class="breadcrumb active" aria-current="page">
                        Logging and Monitoring
                    </li>
                </ol>
            </nav>


            <main class="exp-content">
                <article role="article">

                    <header>
                        <h1 class="article-heading scroll-h1 scroll-original-h1 scroll-relative-h1 scroll-custom-section-heading scroll-document-section-heading" role="heading" data-scroll-heading-rank="1" data-scroll-original-heading-rank="1" data-scroll-relative-heading-rank="1" id="no-src_generated-id-ec2023f4aa3be5f6204c601a90f07023c2fa21e1ee1729c34a4477beb7a221aa">
                            Logging and Monitoring
                        </h1>
                    </header>

                    <section class="page" id="content" role="main">
                        <div id="main-content" class="wiki-content article-content js-tocBot-content">
                            <p>The following sections cover logging the time, report, and leap state and monitoring the current state of the TimeMonitor application.</p><h2 id="LoggingandMonitoring-Logging" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">Logging</h2><p>Logging is configured in <strong>conf/log4j.properties</strong> (given that the wrapper scripts in <strong>bin/</strong> are used to run the application).</p><p>By default, events at <strong>INFO</strong> level are logged to a local file called signserver-timemonitor.log.</p><p>It is recommended to use syslog or similar mechanisms to send the logs to a remote server where they can be inspected when the time is detected to be out of sync.</p><p>The TimeMonitor maintains three types of states: <strong>Time state</strong>, <strong>Report state</strong>, and <strong>Leap state</strong>.</p><h3 id="LoggingandMonitoring-TimeState" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">Time State</h3><p>Time State for time synchronization describes the status of the time source and can be:</p><ul><li><strong>INSYNC</strong>: The time is in sync as it was detected to be within the configured range.</li><li><strong>SOON_OUT_OF_SYNC</strong>: The time is in sync but was detected to be within the configured range to give a warning.</li><li><strong>OUT_OF_SYNC</strong>: The time was detected to be out of sync.</li><li><strong>UNKNOWN</strong>: The status of the time is unknown as the time server has not yet been contacted, it could not be contacted, or some other error occurred preventing the TimeMonitor from getting the status.</li></ul><h3 id="LoggingandMonitoring-ReportState" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">Report State</h3><p>Report State describes the status of the publishing of the results to SignServer and can be:</p><ul><li><strong>REPORTED</strong>: The results were successfully published to SignServer.</li><li><strong>REPORTED_BUT_EXPIRE_TIME_SHORT</strong>: The results were successfully published to SignServer but the time it took to perform the measurements and publish it was longer than the time configured as timemonitor.warnRunTime. The log gives more information about the actual run time and how much time was spent during the query and publishing when the state changes to this state.</li><li><strong>FAILED_TO_REPORT</strong>:&nbsp;The results could not be published to SignServer. An error message could be available in the log when the state changes to this state.</li></ul><h3 id="LoggingandMonitoring-LeapState" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">Leap State</h3><p>Leap State is reported to SignServer with the following values:&nbsp;</p><ul><li><strong>NONE</strong>: No leap second is scheduled at the next possible leap second occurrence.&nbsp;</li></ul><ul><li><strong>POSITIVE</strong>: A positive (inserted) leap second is scheduled at the next possible leap second occurrence.&nbsp;</li></ul><ul><li><strong>NEGATIVE</strong>: A negative (removed) leap second is scheduled at the next possible leap second occurrence.&nbsp;</li></ul><ul><li><strong>UNKNOWN</strong>: Leapsecond state was unknown when querying the time server (for Builtin SNTP) or the NTP daemon (for Local NTP Commands). </li></ul><p>For more information on StatusReportingLocalComputerTimeSource and setting up leap second handling, see <a href="Time_Sources_in_SignServer.html" data-linked-resource-id="371000354" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="371000354" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000354/Time+Sources+in+SignServer" data-scroll-link-target-source-id="371000354">Time Sources in SignServer</a>.</p><h3 id="LoggingandMonitoring-Examples" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">Examples</h3><p>Each time any of the states change, the new Time, Report, and Leap states are logged at INFO level:</p><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>14:56:01,983  INFO TimeMonitorRunnable:60 - Started
14:56:02,491 ERROR TimeMonitorRunnable:214 - Command failed (1): 31 Oct 14:56:02
 ntpdate[26321]: no server suitable for synchronization found
14:56:02,511 ERROR TimeMonitorRunnable:268 - Failed to update status property: Connection
&nbsp;refused
14:56:02,515  INFO TimeMonitorRunnable:91 - State changed to: UNKNOWN,FAILED_TO_REPORT,NONE
14:58:11,152  INFO TimeMonitorRunnable:91 - State changed to: UNKNOWN,REPORTED,NONE
15:01:23,310  INFO TimeMonitorRunnable:91 - State changed to: INSYNC,REPORTED,NONE</pre>
</div></div><p>&nbsp;When the state changes from INSYNC or SOON_OUT_OF_SYNC to either OUT_OF_SYNC or UNKNOWN, an additional log entry outputs the last time determined to be in sync:</p><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>15:32:05,990 INFO&nbsp; [TimeMonitorRunnable] State changed to: INSYNC,REPORTED,NONE
15:32:06,492 INFO&nbsp; [TimeMonitorRunnable] State changed to: OUT_OF_SYNC,REPORTED,NONE
15:32:06,492 INFO&nbsp; [TimeMonitorRunnable] Last trusted time was: 2012-11-27 15:32:05,990</pre>
</div></div><h2 id="LoggingandMonitoring-Monitoring" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">Monitoring</h2><p>The current state of the TimeMonitor application can also be monitored from an external service if the state-showing web (health check) server is enabled.</p><p>Example of getting the current state from the state web page:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">$ curl http:</code><code class="comments">//tsaserver:8980/state</code></div>
<div class="line"><code class="plain"> </code><code class="value">1409050686281</code><code class="plain">,INSYNC,REPORTED,NONE,1ccdf46b,</code><code class="value">0</code><code class="plain">,</code><code class="value">508</code><code class="plain">,</code><code class="value">8</code><code class="plain">,</code><code class="value">6</code><code class="plain"> </code></div>
</div>
</div><p>It is also possible to use the <a href="TimeMonitorStatusReportWorker.html" data-linked-resource-id="371000090" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="371000090" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000090/TimeMonitorStatusReportWorker" data-scroll-link-target-source-id="371000090">TimeMonitorStatusReportWorker</a> to monitor the TimeMonitor application. In this case, the external system sends a request to the worker.</p><p>Example of getting the current state from the TimeMonitorStatusReportWorker:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">$ curl http:</code><code class="comments">//tsaserver:8080/signserver/process -d workerName=TimeMonitorStatusReport -d data=</code></div>
<div class="line"><code class="plain"> </code><code class="value">1409050686281</code><code class="plain">,INSYNC,REPORTED,NONE,1ccdf46b,</code><code class="value">0</code><code class="plain">,</code><code class="value">508</code><code class="plain">,</code><code class="value">8</code><code class="plain">,</code><code class="value">6</code><code class="plain"> </code></div>
</div>
</div><p>The current state is returned as a comma-separated list of values:</p><ol><li>Update time: The current time when the expiration time to set was calculated</li><li>Time state: See states in the <a href="Logging_and_Monitoring.html#LoggingandMonitoring-Logging" data-scroll-target-source-id="371000481" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000481/Logging+and+Monitoring#src-371000481_LoggingandMonitoring-Logging" data-scroll-link-target-source-id="371000481">Logging</a> section.<span class="confluence-anchor-link" id="LoggingandMonitoring-__DdeLink__1320_1230965538"></span><span class="confluence-anchor-link" id="__DdeLink__1320_1230965538"></span></li><li>Report state: See states in the&nbsp;<a href="Logging_and_Monitoring.html#LoggingandMonitoring-Logging" data-scroll-target-source-id="371000481" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000481/Logging+and+Monitoring#src-371000481_LoggingandMonitoring-Logging" data-scroll-link-target-source-id="371000481">Logging</a> section.</li><li>Leap state: See states in the <a href="Logging_and_Monitoring.html#LoggingandMonitoring-Logging" data-scroll-target-source-id="371000481" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000481/Logging+and+Monitoring#src-371000481_LoggingandMonitoring-Logging" data-scroll-link-target-source-id="371000481">Logging</a> section.</li><li>Config version: Identifier for the last configuration received.</li><li>Time offset: The measured difference in time with the time server.</li><li>Time server query time: The time it took to query the time server.</li><li>NTP daemon query time: The time it took to query the leap state.</li><li>Report time: The time it took to report the status to SignServer.</li></ol><h2 id="LoggingandMonitoring-Rate-limiting" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">Rate-limiting</h2><p>If an NTP server responds with a rate-limiting "kiss of death" response, the time monitor will log an error and stop querying and the state will be set to UNKNOWN. The time monitor will resume querying on the next configuration update (i.e. setting another NTP server host).</p>
                        </div>
                    </section>

                </article>
            </main>


                <nav class="exp-post-navigation-prev">
                    <a href="TimeMonitor_Configuration.html" class="post-navigation-link">
                        <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg">
                            <g id="ht-icon-prev">
                                <path fill="currentColor" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) " />
                            </g>
                        </svg>
                        <span>TimeMonitor Configuration</span>
                    </a>
                </nav>

                <nav class="exp-post-navigation-next">

                    <a href="Set_up_a_Test_Time_Server_with_a_Simulated_Time.html" class="post-navigation-link">
                        <span>Set up a Test Time Server with a Simulated Time</span>
                        <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg">
                            <g id="ht-icon-next">
                                <path fill="currentColor" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) " />
                            </g>
                        </svg>
                    </a>

                </nav>


            <nav class="exp-sidebar-toc js-tocBot">
                <!-- content generated by toc.js  -->
            </nav>

            <div class="exp-sidebar-navigation-toggle">
                <div class="exp-sidebar-navigation-toggle-icon-line"></div>
                <div class="exp-sidebar-navigation-toggle-icon-line"></div>
                <div class="exp-sidebar-navigation-toggle-icon-line"></div>
            </div>

            <div class="exp-scroll-to-top-container">
                <a href="#LoggingandMonitoring-top" class="exp-scroll-to-top-link">↑ Back to top</a>
            </div>

        </div>



<dialog class="exp-lightbox-container" aria-modal="true">
    <div class="lightbox-toolbar">
        <button type="button" class="exp-lightbox-close">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 -960 960 960" aria-hidden="true">
                <path fill="currentColor" d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z" />
            </svg>
        </button>
    </div>
    <div class="lightbox-content content">
    </div>
</dialog>

<template id="exp-lightbox-wrapper-template">
    <div class="exp-lightbox-wrapper">
        <div class="exp-lightbox-toggle">
            <button type="button" class="exp-lightbox-close">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 -960 960 960" aria-hidden="true">
                    <path fill="currentColor" d="M120-120v-320h80v184l504-504H520v-80h320v320h-80v-184L256-200h184v80H120Z" />
                </svg>
            </button>
        </div>
    </div>
</template>

        <script src="js/tocbot.min.js"></script>
        <script src="js/article-toc.js"></script>
        <script src="js/app.js"></script>
        <script src="js/mobile.js"></script>
        <script src="js/iframe-resizer.parent.js"></script>

    </body>

</html>