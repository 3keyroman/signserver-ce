<!doctype html>

<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">

        <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1">

        <link rel="icon" href="_scroll_external/attachments/e415105eb31a/ssdocs">

        <!-- Primary Meta Tags -->
        <meta name="exp-export-timestamp" content="2024-10-09T09:35:55.791+0000">
        <meta name="exp-page-id" content="370999556">
        <meta name="exp-page-title" content="Troubleshooting">
        <meta name="exp-page-version" content="1">
        <meta name="exp-page-scroll-page-id" content="cf8d26868670236552d62da81877b439">
        <meta name="exp-page-created" content="2023-08-30T12:46:12.000+0000">
        <meta name="exp-page-last-modified" content="2023-09-12T11:55:46.000+0000">
        <meta name="exp-page-labels" content="">
        <meta name="exp-page-context-keys" content="">
        <meta name="exp-space-key" content="SSDOCS">
        <meta name="exp-space-title" content="SignServer Documentation">

        <!-- Additional Meta Tags -->
        <meta name="exp-document-id" content="371111034">
        <meta name="exp-document-title" content="SignServer Documentation">
        <meta name="exp-version-status" content="in-progress">
        <meta name="exp-version-id" content="8a3e757d15e64586aa644eaf0980f27a">
        <meta name="exp-version-name" content="Working version">
        <meta name="exp-version-description" content="">
        <meta name="exp-version-date" content="2024-02-17T13:18:25Z">
        <meta name="exp-variant-id" content="">
        <meta name="exp-variant-name" content="">
        <meta name="exp-variant-description" content="">
        <meta name="exp-language-code" content="">
        <meta name="exp-language-name" content="">

        <link rel="stylesheet" href="css/app.css">
        <link rel="stylesheet" href="css/image-dimensions.css">


            
            
<script src="js/search.js"></script>
            <script id="search-worker" type="javascript/worker">
    onmessage = function(event) {
        // dispatch events to handling functions
        var message = event.data;

        if ((message.type === 'setup') && message.baseUrl) {
            setup(message.baseUrl);
        }

        if (message.type === 'search-request') {
            search(message.query);
        }
    }

    var searchIndex;

    function setup(baseUrl) {
        importScripts(
            baseUrl + 'js/lunr.js',
            baseUrl + 'js/lunr-index.js',
            baseUrl + 'js/lunr-data.js'
        );
        try {
            // load lunr-extras if it exists, which contains language-specific files for languages other than english
            importScripts(baseUrl + 'js/lunr-extras.js');
        } catch (e) {}
        searchIndex = lunr.Index.load(lunrIndex);
    }

    function search(query) {
        var searchHits = searchIndex.search(query);
        var results = searchHits.map(function (result) {
            return lunrData.filter(function (d) {
                return d.id === result.ref;
            })[0]
        });
        postMessage({ type: 'search-results', results: results, query: query });
    }
</script>
        <title>Troubleshooting</title>

    <meta name="generator" content="Scroll HTML Exporter / K15t GmbH"></head>

    <body id="Troubleshooting-top" data-pageid="370999556" data-confluence-editor-version="v1" data-confluence-deployment-type="CLOUD">

        <div class="exp-grid-container">

            <header class="exp-header"></header>

            <div class="exp-logo">
                <a href="SignServer_Documentation.html">
                    <span class="exp-logo-image" style="background-image: url(_scroll_external/attachments/e415105eb31a/ssdocs)" alt="SignServer Documentation" title="SignServer Documentation"></span>
                </a>
            </div>

            <div class="exp-document-title">
                <h1 class="exp-document-title-heading scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h1 scroll-relative-h1" data-scroll-heading-rank="1" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="1" id="no-src_generated-id-c2cf8d5ef3b3cbbded74a553d6e2830c76300e15e16dcbe641ad55c28d32068f">
                    <a href="SignServer_Documentation.html">
                        SignServer Documentation
                    </a>
                </h1>
            </div>

<div class="exp-search-container">
    <input type="search" id="search-textbox" autocomplete="off" class="exp-search-input" style="margin-right: 0;">
    <div class="exp-search-input-icon">
        <svg data-exp-id="magnifier-icon" data-exp-component="icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewbox="0 0 20 20" fill="none" aria-hidden="true">
            <path d="M8.99452 14.5C10.5121 14.5 11.809 13.9669 12.8854 12.9007C13.9618 11.8345 14.5 10.5361 14.5 9.00548C14.5 7.48794 13.9631 6.19097 12.8893 5.11458C11.8155 4.03819 10.519 3.5 9 3.5C7.46786 3.5 6.16816 4.0369 5.1009 5.11071C4.03363 6.18453 3.5 7.48096 3.5 9C3.5 10.5321 4.0331 11.8318 5.09929 12.8991C6.1655 13.9664 7.46391 14.5 8.99452 14.5ZM9 16C8.02913 16 7.11974 15.816 6.27185 15.4479C5.42395 15.0799 4.68056 14.5799 4.04167 13.9479C3.40278 13.316 2.90278 12.576 2.54167 11.728C2.18056 10.88 2 9.97053 2 8.99956C2 8.04152 2.18403 7.13542 2.55208 6.28125C2.92014 5.42708 3.41864 4.68387 4.04758 4.0516C4.67653 3.41935 5.41569 2.91935 6.26508 2.5516C7.11449 2.18387 8.02548 2 8.99806 2C9.95769 2 10.8646 2.18403 11.7188 2.55208C12.5729 2.92014 13.316 3.42014 13.9479 4.05208C14.5799 4.68403 15.0799 5.42612 15.4479 6.27835C15.816 7.13058 16 8.0381 16 9.00094C16 9.83365 15.8615 10.6213 15.5846 11.3638C15.3078 12.1062 14.9254 12.7836 14.4375 13.3958L18 16.9583L16.9375 18L13.375 14.4583C12.7668 14.9459 12.0939 15.3247 11.3564 15.5948C10.6188 15.8649 9.83333 16 9 16Z" fill="currentColor" />
        </svg>
    </div>
    <div id="search-suggestion-container" class="exp-search-suggestion-panel" data-exp-component="search-suggestion"></div>
    <template id="exp-search-suggestion-option-template">
        <div class="exp-search-suggestion-option-container search-form-suggestion">
            <a class="exp-search-suggestion-option search-form-suggestion" href=""></a>
        </div>
    </template>
</div>


            <nav class="exp-sidebar-navigation">
                <div class="exp-sidebar-navigation-sticky-wrapper">
                    <iframe src="toc.html?pageId=370999556" border="0"></iframe>
                </div>

            </nav>


            <nav aria-label="Breadcrumb" class="exp-breadcrumbs-wrapper">
                <ol class="breadcrumbs">
                        <li class="breadcrumb">
                            <a href="SignServer_Documentation.html" rel="prev" target="_self">SignServer Documentation</a>
                        </li>
                        <li class="breadcrumb">
                            <a href="SignServer_Operations.html" rel="prev" target="_self">SignServer Operations</a>
                        </li>
                    <li class="breadcrumb active" aria-current="page">
                        Troubleshooting
                    </li>
                </ol>
            </nav>


            <main class="exp-content">
                <article role="article">

                    <header>
                        <h1 class="article-heading scroll-h1 scroll-original-h1 scroll-relative-h1 scroll-custom-section-heading scroll-document-section-heading" role="heading" data-scroll-heading-rank="1" data-scroll-original-heading-rank="1" data-scroll-relative-heading-rank="1" id="no-src_generated-id-21148ced4e7ae23caae74f6fea86594eee808f8cb8dc394e9e55e05afe44dadf">
                            Troubleshooting
                        </h1>
                    </header>

                    <section class="page" id="content" role="main">
                        <div id="main-content" class="wiki-content article-content js-tocBot-content">
                            <p><span style="color: rgb(0,0,0);text-decoration: none;">The following provides troubleshooting tips to help you get back on track and includes solutions or workarounds for </span><span style="color: rgb(0,0,0);text-decoration: none;">common errors.<br clear="none"></span></p><p></p><h2 id="Troubleshooting-DebugLogging" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">Debug Logging</h2><p>To troubleshoot unexpected behavior in SignServer, enable more detailed (debug) logging by running the following command in the JBoss CLI:</p><ol><li><p class="auto-cursor-target">Start JBoss CLI:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">APPSRV_HOME/bin/jboss-cli.sh -c</code></div>
</div>
</div></li><li><p class="auto-cursor-target">Run the following commands to enable DEBUG logging:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/subsystem=logging/logger=org.ejbca:write-attribute(name=level, value=DEBUG)</code></div>
<div class="line"><code class="plain">/subsystem=logging/logger=org.cesecore:write-attribute(name=level, value=DEBUG)</code></div>
<div class="line"><code class="plain">/subsystem=logging/logger=org.signserver:write-attribute(name=level, value=DEBUG)</code></div>
</div>
</div></li></ol><h2 id="Troubleshooting-GeneralIssues" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">General Issues</h2><h3 id="Troubleshooting-Transactionrolledbackerror" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">Transaction rolled back error</h3><p>A transaction timeout can occur for requests that are taking longer time to finish than what is configured for database transactions in the application server.</p><p>Example of errors displayed in the log:</p><div class="scroll-code scroll-highlighted-code-block" data-language="text" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">13:21:17,483 ERROR [org.jboss.as.ejb3.invocation] (http-/0.0.0.0:8443-1) JBAS014134: EJB Invocation failed on component ProcessSessionBean for method public abstract org.signserver.common.data.Response org.signserver.ejb.interfaces.ProcessSessionLocal.process(org.signserver.server.log.AdminInfo,org.signserver.common.WorkerIdentifier,org.signserver.common.data.Request,org.signserver.common.RequestContext) throws org.signserver.common.IllegalRequestException,org.signserver.common.CryptoTokenOfflineException,org.signserver.common.SignServerException: javax.ejb.EJBTransactionRolledbackException: Transaction rolled back</code></div>
<div class="line"><code class="plain">...</code></div>
<div class="line"><code class="plain">Caused by: javax.transaction.RollbackException: JBAS014585: Transaction 'TransactionImple &lt; ac, BasicAction: 0:ffff7f000001:672b819:5911a12e:f8 status: ActionStatus.ABORTED &gt;' was already rolled back</code></div>
<div class="line"><code class="plain">    at org.jboss.as.ejb3.tx.CMTTxInterceptor.endTransaction(CMTTxInterceptor.java:99) [jboss-as-ejb3-7.5.0.Final-redhat-21.jar:7.5.0.Final-redhat-21]</code></div>
<div class="line"><code class="plain">    ... 100 more</code></div>
</div>
</div><p>Possible reasons include large file uploads and/or downloads, and/or slow network connections, slow HSM connection or HSM, or that contacting external servers takes a long time (CRL/OCSP fetching or time-stamping etc).</p><h4 id="Troubleshooting-Solutions" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-original-h4 scroll-custom-section-heading scroll-document-section-heading scroll-h4 scroll-relative-h4">Solutions</h4><ul><li>Since database transactions are not required if the worker is not configured to access the database, disabling the <span class="confluence-link">key usage counter</span>, and not using any <span class="confluence-link">archiver</span>s will resolve this issue. For more information, see <a href="Limiting_the_number_of_signatures.html" data-linked-resource-id="370999751" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999751" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999751/Limiting+the+number+of+signatures" data-scroll-link-target-source-id="370999751">Limiting the number of signatures</a> and <a href="Archiving.html" data-linked-resource-id="370999739" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999739" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999739/Archiving" data-scroll-link-target-source-id="370999739">Archiving</a>.</li><li>Alternatively, if the <span class="confluence-link">key usage counter</span> or an <span class="confluence-link">Archiver</span> must be used, reconfigure the application server with a higher value for the transaction timeout. For more information, see <a href="Limiting_the_number_of_signatures.html" data-linked-resource-id="370999751" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999751" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999751/Limiting+the+number+of+signatures" data-scroll-link-target-source-id="370999751">Limiting the number of signatures</a> and <a href="Archiving.html" data-linked-resource-id="370999739" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999739" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999739/Archiving" data-scroll-link-target-source-id="370999739">Archiving</a>.</li></ul><h3 id="Troubleshooting-CKR_PIN_INCORRECT(LunaHSM)" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">CKR_PIN_INCORRECT (Luna HSM)</h3><p>When attempting to log into a Luna HSM, the HSM may require a PIN code from an external PIN pad. If you subsequently try to log in via an application, you might encounter a misleading exception.</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">ERROR [org.signserver.server.cryptotokens.PKCS11CryptoToken] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">2</code><code class="plain">) Activate failed: Failed to initialize PKCS11 provider slot </code><code class="string">'CAAUTHDEV'</code><code class="plain">.: load failed: CKR_PIN_INCORRECT</code></div>
</div>
</div><p>A workaround we've seen could be to set<strong> ProtectedAuthenticationPathFlagStatus = 1</strong> in the config file of the HSM</p><h3 class="editable-field inactive scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3" title="Click to edit" id="Troubleshooting-SQLFeatureNotSupportedExceptionwithPostgreSQL" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3">SQLFeatureNotSupportedException with PostgreSQL</h3><p>When running SignServer with certain versions of PostgreSQL, an SQLFeatureNotSupportedException can occur on any database insert. By disabling the L2 and query cache you can forgo this issue. See <a href="Deploy-time_Configuration.html" data-linked-resource-id="370999711" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999711" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999711/Deploy-time+Configuration" data-scroll-link-target-source-id="370999711">Deploy-time Configuration</a>.</p><h2 id="Troubleshooting-P11NG/JackNJI11" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">P11NG / JackNJI11</h2><h3 id="Troubleshooting-UnsatisfiedLinkError" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">UnsatisfiedLinkError</h3><p>There can be a conflict between the JNA implementation in SignServer and the one installed in the system. This can be seen as errors similar to the following:</p><ul style="list-style-type: square;"><li>java.lang.UnsatisfiedLinkError: com.sun.jna.Native.malloc(J)J</li><li>java.lang.UnsatisfiedLinkError: Can't obtain static newInstance method for class com.sun.jna.Structure</li></ul><p>The solution is to remove JNA from the system (i.e. apt-get remove libjna-java) or to run Java with:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">-Djava.library.path=</code></div>
</div>
</div><h3 id="Troubleshooting-USER_NOT_LOGGED_INError" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">USER_NOT_LOGGED_IN Error</h3><p>If a <strong>USER_NOT_LOGGED_IN</strong> error is encountered while using the Utimaco HSM, the solution is to enable the <strong>KeepAlive</strong> setting in the Utimaco configuration<span style="color: rgb(0,0,0);"> file <code>cs_pkcs11_R2.cfg</code>:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain"># Prevents expiring session after inactivity of </code><code class="value">15</code><code class="plain"> minutes</code></div>
<div class="line"><code class="plain">KeepAlive = </code><code class="keyword">true</code></div>
</div>
</div><h2 id="Troubleshooting-SunPKCS11/PKCS11CryptoTokenandJava17" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">SunPKCS11 / PKCS11CryptoToken and Java 17</h2><p>The PKCS11CryptoToken does not work on Java 17 unless the Java process that runs the application server is passed the JAVA_OPTS parameter &nbsp;"--add-exports=jdk.crypto.cryptoki/sun.security.pkcs11.wrapper=ALL-UNNAMED".</p><p>When using the PKCS11CryptoToken an error similar to the following may be logged:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="value">19</code><code class="plain">:</code><code class="value">54</code><code class="plain">:</code><code class="value">50</code><code class="plain">,</code><code class="value">047</code><code class="plain"> ERROR [com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapper] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">1</code><code class="plain">) Method sun.security.pkcs11.wrapper.PKCS11.CK_C_INITIALIZE_ARGS.getInstance was not accessible, </code><code class="keyword">this</code><code class="plain"> may be due to a change in the underlying library.: java.lang.IllegalAccessException: </code><code class="keyword">class</code><code class="plain"> com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapper cannot access </code><code class="keyword">class</code><code class="plain"> sun.security.pkcs11.wrapper.PKCS11 (in module jdk.crypto.cryptoki) because module jdk.crypto.cryptoki does not export sun.security.pkcs11.wrapper to unnamed module </code><code class="color1">@64dbc7bd</code></div>
</div>
</div><h2 id="Troubleshooting-SunPKCS11/PKCS11CryptoTokenandcertainJava17versions" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">SunPKCS11 / PKCS11CryptoToken and certain Java 17 versions</h2><p>Certain Java 17 versions/builds attempt to call C_GetInfo before the call C_Initialize, resulting in many HSM drivers responding with CKR_CRYPTOKI_NOT_INITIALIZED.The issue has been observed with OpenJDK 17 version Red_Hat-17.0.6.0.10-1.fc36 and switching to a different Java version/build is the only known solution.</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain"> </code><code class="value">12</code><code class="plain">:</code><code class="value">30</code><code class="plain">:</code><code class="value">33</code><code class="plain">,</code><code class="value">581</code><code class="plain"> ERROR [stderr] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">1</code><code class="plain">) sunpkcs11: Initializing PKCS#</code><code class="value">11</code><code class="plain"> library /opt/ETcpsdk/lib/linux-x86_64/libctsw.so</code></div>
<div class="line"><code class="value">12</code><code class="plain">:</code><code class="value">30</code><code class="plain">:</code><code class="value">33</code><code class="plain">,</code><code class="value">582</code><code class="plain"> ERROR [stderr] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">1</code><code class="plain">) sunpkcs11: Multi-threaded initialization failed: sun.security.pkcs11.wrapper.PKCS11Exception: CKR_CRYPTOKI_NOT_INITIALIZED</code></div>
<div class="line"><code class="value">12</code><code class="plain">:</code><code class="value">30</code><code class="plain">:</code><code class="value">33</code><code class="plain">,</code><code class="value">582</code><code class="plain"> ERROR [com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapper] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">1</code><code class="plain">) Wrong arguments were passed to sun.security.pkcs11.wrapper.PKCS11.CK_C_INITIALIZE_ARGS.getInstance threw an exception </code><code class="keyword">for</code><code class="plain"> log.error(msg, e): java.lang.reflect.InvocationTargetException</code></div>
<div class="line"><code class="plain">    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</code></div>
<div class="line"><code class="plain">    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</code><code class="value">77</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</code><code class="value">43</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at java.base/java.lang.reflect.Method.invoke(Method.java:</code><code class="value">568</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapper.&lt;init&gt;(SunP11SlotListWrapper.java:144)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapperFactory.getInstance(SunP11SlotListWrapperFactory.java:74)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapperFactory.getInstance(SunP11SlotListWrapperFactory.java:35)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.Pkcs11SlotLabel.getSlotListWrapper(Pkcs11SlotLabel.java:566)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.Pkcs11SlotLabel.getProvider(Pkcs11SlotLabel.java:120)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.Pkcs11SlotLabel.getP11Provider(Pkcs11SlotLabel.java:551)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.Pkcs11SlotLabel.getP11Provider(Pkcs11SlotLabel.java:516)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.P11Slot.&lt;init&gt;(P11Slot.java:57)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.P11Slot.getInstance(P11Slot.java:246)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.P11Slot.getInstance(P11Slot.java:203)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.P11Slot.getInstance(P11Slot.java:181)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.cesecore.keys.token.PKCS11CryptoToken.delayedInit(PKCS11CryptoToken.java:130)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.cesecore.keys.token.PKCS11CryptoToken.getP11slotWithDelayedInit(PKCS11CryptoToken.java:296)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.cesecore.keys.token.PKCS11CryptoToken.activate(PKCS11CryptoToken.java:153)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.BaseCryptoToken.autoActivate(BaseCryptoToken.java:115)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.BaseCryptoToken.getKeyStore(BaseCryptoToken.java:97)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.BaseCryptoToken.getTokenStatus(BaseCryptoToken.java:655)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.signserver.server.cryptotokens.PKCS11CryptoToken.getCryptoTokenStatus(PKCS11CryptoToken.java:308)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.signserver.server.signers.BaseSigner.isCryptoTokenActive(BaseSigner.java:376)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.signserver.server.signers.BaseSigner.getStatus(BaseSigner.java:103)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.signserver.server.signers.CryptoWorker.getStatus(CryptoWorker.java:37)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear.SignServer-ejb.jar</code><code class="comments">//org.signserver.ejb.WorkerSessionBean.getStatus(WorkerSessionBean.java:287)</code></div>
<div class="line"><code class="plain">&lt;...&gt;</code></div>
<div class="line"><code class="plain">    at org.jboss.xnio</code><code class="color1">@3</code><code class="plain">.8.</code><code class="value">7</code><code class="plain">.Final</code><code class="comments">//org.xnio.XnioWorker$WorkerThreadFactory$1$1.run(XnioWorker.java:1282)</code></div>
<div class="line"><code class="plain">    at java.base/java.lang.Thread.run(Thread.java:</code><code class="value">833</code><code class="plain">)</code></div>
<div class="line"><code class="plain">Caused by: sun.security.pkcs11.wrapper.PKCS11Exception: CKR_CRYPTOKI_NOT_INITIALIZED</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11.C_GetInfo(Native Method)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11$SynchronizedPKCS11.C_GetInfo(PKCS11.java:</code><code class="value">1681</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11.&lt;init&gt;(PKCS11.java:</code><code class="value">156</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11$SynchronizedPKCS11.&lt;init&gt;(PKCS11.java:</code><code class="value">1668</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11.getInstance(PKCS11.java:</code><code class="value">194</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11.getInstance(PKCS11.java:</code><code class="value">166</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    ... </code><code class="value">248</code><code class="plain"> more</code></div>
<div class="line"><code class="plain">  </code></div>
</div>
</div><h2 id="Troubleshooting-SignClient" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-original-h2 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">SignClient</h2><h3 id="Troubleshooting-CannotProduceCertificateVerifySignature" data-scroll-heading-rank-offset="1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">Cannot Produce CertificateVerify Signature</h3><p>When using SignClient using a PKCS 11 token (e.g. a smart-card reader) for authenticating in some cases (e.g. both server and client running on Java 11) a cipher-suit-related error can occur:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">ERROR [HTTPDocumentSigner] Failed sending request: Cannot produce CertificateVerify signature</code></div>
</div>
</div><p>As a workaround, SignClient can be forced to fall back to using TLS version 1.2 (as shown in the commented-out sample in script bin/signclient, a similar example is also present in the Windows batch file bin/signclient.cmd)</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain"># In some cases, running SignClient authenticating with a P11 token</code></div>
<div class="line"><code class="plain"># (e.g. a smartcard reader) could give cipher-suit errors,</code></div>
<div class="line"><code class="plain"># In these cases, a workaround is to force the use of TLS version </code><code class="value">1.2</code></div>
<div class="line"><code class="plain">JAVA_OPTS=</code><code class="string">"$JAVA_OPTS  -Djdk.tls.client.protocols=TLSv1.2 -Dhttps.protocols=TLSv1.2"</code></div>
</div>
</div>
                        </div>
                    </section>

                </article>
            </main>


                <nav class="exp-post-navigation-prev">
                    <a href="Setting_up_Request_Prioritization.html" class="post-navigation-link">
                        <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg">
                            <g id="ht-icon-prev">
                                <path fill="currentColor" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) " />
                            </g>
                        </svg>
                        <span>Setting up Request Prioritization</span>
                    </a>
                </nav>

                <nav class="exp-post-navigation-next">

                    <a href="SignServer_Integration.html" class="post-navigation-link">
                        <span>SignServer Integration</span>
                        <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg">
                            <g id="ht-icon-next">
                                <path fill="currentColor" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) " />
                            </g>
                        </svg>
                    </a>

                </nav>


            <nav class="exp-sidebar-toc js-tocBot">
                <!-- content generated by toc.js  -->
            </nav>

            <div class="exp-sidebar-navigation-toggle">
                <div class="exp-sidebar-navigation-toggle-icon-line"></div>
                <div class="exp-sidebar-navigation-toggle-icon-line"></div>
                <div class="exp-sidebar-navigation-toggle-icon-line"></div>
            </div>

            <div class="exp-scroll-to-top-container">
                <a href="#Troubleshooting-top" class="exp-scroll-to-top-link">↑ Back to top</a>
            </div>

        </div>



<dialog class="exp-lightbox-container" aria-modal="true">
    <div class="lightbox-toolbar">
        <button type="button" class="exp-lightbox-close">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 -960 960 960" aria-hidden="true">
                <path fill="currentColor" d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z" />
            </svg>
        </button>
    </div>
    <div class="lightbox-content content">
    </div>
</dialog>

<template id="exp-lightbox-wrapper-template">
    <div class="exp-lightbox-wrapper">
        <div class="exp-lightbox-toggle">
            <button type="button" class="exp-lightbox-close">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 -960 960 960" aria-hidden="true">
                    <path fill="currentColor" d="M120-120v-320h80v184l504-504H520v-80h320v320h-80v-184L256-200h184v80H120Z" />
                </svg>
            </button>
        </div>
    </div>
</template>

        <script src="js/tocbot.min.js"></script>
        <script src="js/article-toc.js"></script>
        <script src="js/app.js"></script>
        <script src="js/mobile.js"></script>
        <script src="js/iframe-resizer.parent.js"></script>

    </body>

</html>